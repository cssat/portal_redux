-- create REMOVAL_EPISODE_FACT table

-- DROP TABLE portal_redux.REMOVAL_EPISODE_FACT;
CREATE TABLE portal_redux.REMOVAL_EPISODE_FACT (
	ID_REMOVAL_EPISODE_FACT int NOT NULL,
	ID_EPSD int NULL,
	ID_CALENDAR_DIM_AFCARS_BEGIN int NULL,
	ID_CALENDAR_DIM_AFCARS_END int NULL,
	ID_CALENDAR_DIM_BEGIN int NOT NULL,
	ID_CALENDAR_DIM_END int NULL,
	ID_CALENDAR_DIM_FIRST_HEALTH_SAFETY_VISIT int NULL,
	ID_CASE_DIM int NOT NULL,
	ID_DISCHARGE_REASON_DIM int NOT NULL,
	ID_FAMILY_STRUCTURE_DIM int NULL,
	ID_LOCATION_DIM_REMOVAL int NULL,
	ID_LOCATION_DIM_WORKER int NULL,
	ID_PEOPLE_DIM_CHILD int NOT NULL,
	ID_PEOPLE_DIM_PARENT_PRIMARY int NULL,
	ID_PEOPLE_DIM_PARENT_SECONDARY int NULL,
	ID_PLACEMENT_CARE_AUTH_DIM int NULL,
	ID_REMOVAL_DIM int NOT NULL,
	ID_WORKER_DIM_CURRENT int NULL,
	ID_WORKER_DIM_ORIGINAL int NULL,
	FL_AAFC tinyint NULL,
	FL_ABANDONMENT tinyint NULL,
	FL_ABUSE tinyint NULL,
	FL_CARETAKER_INABILITY_COPE tinyint NULL,
	FL_CHILD_ABUSE_ALCOHOL tinyint NULL,
	FL_CHILD_ABUSES_DRUG tinyint NULL,
	FL_CHILD_BEHAVIOR_PROBLEMS tinyint NULL,
	FL_CHILD_CLINICALLY_DIAGNOSED tinyint NULL,
	FL_IN_ERROR tinyint NULL,
	FL_INADEQUATE_HOUSNG tinyint NULL,
	FL_NEGLECT tinyint NULL,
	FL_PARENT_ABUSE_ALCOHOL tinyint NULL,
	FL_PARENT_DEATH tinyint NULL,
	FL_PARENT_DRUG_ABUSE tinyint NULL,
	FL_PARENT_INCARCERATION int NULL,
	FL_PHYSICAL_ABUSE tinyint NULL,
	FL_REENTRY tinyint NULL,
	FL_RELINQUISHMENT tinyint NULL,
	FL_SEX_ABUSE tinyint NULL,
	CHILD_AGE_REMOVAL_BEGIN int NULL,
	CHILD_AGE_REMOVAL_END int NULL,
	LENGTH_OF_STAY int NULL,
	ID_LEGAL_STATUS_DIM int NULL,
	ID_PLACEMENT_RESULT_DIM_LATEST int NULL,
	FL_TRIAL_RETURN_HOME tinyint NULL,
	ID_PRSN_CHILD int NULL,
	ID_PRSN_PARENT_PRIMARY int NULL,
	ID_PRSN_PARENT_SECONDARY int NULL,
	ID_CASE int NULL,
	FL_EXTENDED_FOSTER_CARE tinyint NULL,
	CONSTRAINT PK_REMOVAL_EPISODE_FACT PRIMARY KEY (ID_REMOVAL_EPISODE_FACT),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_CALENDAR_DIM_AFCARS_END FOREIGN KEY (ID_CALENDAR_DIM_AFCARS_END) REFERENCES portal_redux.CALENDAR_DIM(ID_CALENDAR_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_CALENDAR_DIM_BEGIN FOREIGN KEY (ID_CALENDAR_DIM_BEGIN) REFERENCES portal_redux.CALENDAR_DIM(ID_CALENDAR_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_CALENDAR_DIM_END FOREIGN KEY (ID_CALENDAR_DIM_END) REFERENCES portal_redux.CALENDAR_DIM(ID_CALENDAR_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_CALENDAR_DIM_FIRST_HEALTH_SAFETY_VISIT FOREIGN KEY (ID_CALENDAR_DIM_FIRST_HEALTH_SAFETY_VISIT) REFERENCES portal_redux.CALENDAR_DIM(ID_CALENDAR_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_CASE_DIM FOREIGN KEY (ID_CASE_DIM) REFERENCES portal_redux.CASE_DIM(ID_CASE_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_LEGAL_STATUS_DIM FOREIGN KEY (ID_LEGAL_STATUS_DIM) REFERENCES portal_redux.LEGAL_STATUS_DIM(ID_LEGAL_STATUS_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_LOCATION_DIM_REMOVAL FOREIGN KEY (ID_LOCATION_DIM_REMOVAL) REFERENCES portal_redux.LOCATION_DIM(ID_LOCATION_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_LOCATION_DIM_WORKER FOREIGN KEY (ID_LOCATION_DIM_WORKER) REFERENCES portal_redux.LOCATION_DIM(ID_LOCATION_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_PEOPLE_DIM_CHILD FOREIGN KEY (ID_PEOPLE_DIM_CHILD) REFERENCES portal_redux.PEOPLE_DIM(ID_PEOPLE_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_PEOPLE_DIM_PARENT_PRIMARY FOREIGN KEY (ID_PEOPLE_DIM_PARENT_PRIMARY) REFERENCES portal_redux.PEOPLE_DIM(ID_PEOPLE_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_PEOPLE_DIM_PARENT_SECONDARY FOREIGN KEY (ID_PEOPLE_DIM_PARENT_SECONDARY) REFERENCES portal_redux.PEOPLE_DIM(ID_PEOPLE_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_PLACEMENT_CARE_AUTH_DIM FOREIGN KEY (ID_PLACEMENT_CARE_AUTH_DIM) REFERENCES portal_redux.PLACEMENT_CARE_AUTH_DIM(ID_PLACEMENT_CARE_AUTH_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_PLACEMENT_RESULT_DIM_LATEST FOREIGN KEY (ID_PLACEMENT_RESULT_DIM_LATEST) REFERENCES portal_redux.PLACEMENT_RESULT_DIM(ID_PLACEMENT_RESULT_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_REMOVAL_DIM FOREIGN KEY (ID_REMOVAL_DIM) REFERENCES portal_redux.REMOVAL_DIM(ID_REMOVAL_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_WORKER_DIM_CURRENT FOREIGN KEY (ID_WORKER_DIM_CURRENT) REFERENCES portal_redux.WORKER_DIM(ID_WORKER_DIM),
	CONSTRAINT fk_REMOVAL_EPISODE_FACT_ID_WORKER_DIM_ORIGINAL FOREIGN KEY (ID_WORKER_DIM_ORIGINAL) REFERENCES portal_redux.WORKER_DIM(ID_WORKER_DIM)
);

-- load table data

BULK INSERT portal_redux.REMOVAL_EPISODE_FACT
FROM 'D:\S3\fldw-in\REMOVAL_EPISODE_FACT.txt'
WITH (
    firstrow = 2,
    fieldterminator = '|',
    rowterminator = '\n'
);